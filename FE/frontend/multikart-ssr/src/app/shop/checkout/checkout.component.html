<app-breadcrumb [title]="'Checkout'" [breadcrumb]="'Checkout'"></app-breadcrumb>
<section class="section-b-space">
  <div class="container padding-cls">
    <div class="checkout-page">
      <div class="checkout-form">
        <form [formGroup]="checkoutForm">
          <div class="row">
            <div class="col-lg-6 col-sm-12 col-xs-12">
              <div class="checkout-title">
                <h3>Billing Details</h3>
              </div>
              <div class="checkout-title">
                <h4>Shipping Address</h4>
              </div>
              <div formArrayName="address" class="row check-out">
                <nz-collapse nzGhost nzAccordion class="accordion">
                  <ng-container
                    *ngFor="let address of addresses.controls; index as i"
                  >
                    <nz-collapse-panel
                      [nzHeader]="header"
                      [nzActive]="i == 0"
                      [formGroupName]="i"
                      (nzActiveChange)="onChangeSelectedAddress($event, i)"
                      class="accordion_panel"
                    >
                      <ng-template #header>
                        <span *ngIf="!address.value.cap"
                          >Insert you Address</span
                        >
                        <span *ngIf="address.value.cap"
                          >Indirizzo {{ i + 1 }}</span
                        >
                      </ng-template>
                      <div class="form-group col-md-12 col-sm-12 col-xs-12">
                        <div class="field-label">Flat</div>
                        <input
                          type="text"
                          name="address"
                          value=""
                          formControlName="flat"
                        />
                      </div>
                      <div class="form-group col-md-12 col-sm-12 col-xs-12">
                        <div class="field-label">Address</div>
                        <input
                          type="text"
                          name="town"
                          formControlName="address"
                          value=""
                          placeholder=""
                          autocomplete="off"
                        />
                      </div>
                      <div class="form-group col-md-12 col-sm-6 col-xs-12">
                        <div class="field-label">City</div>
                        <input
                          type="text"
                          name="state"
                          formControlName="city"
                          value=""
                          placeholder=""
                          autocomplete="off"
                        />
                      </div>
                      <div class="form-group col-md-12 col-sm-6 col-xs-12">
                        <div class="field-label">Postal Code</div>
                        <input
                          type="text"
                          name="postalcode"
                          value=""
                          formControlName="cap"
                          placeholder=""
                          autocomplete="off"
                        />
                      </div>
                      <div class="form-group col-md-12 col-sm-6 col-xs-12">
                        <div class="field-label">Region</div>
                        <input
                          type="text"
                          name="postalcode"
                          formControlName="region"
                          value=""
                          placeholder=""
                          autocomplete="off"
                        />
                      </div>
                      <div class="form-group col-md-12 col-sm-6 col-xs-12">
                        <div class="field-label">Other information</div>
                        <input
                          type="text"
                          name="postalcode"
                          formControlName="other"
                          value=""
                          placeholder=""
                          autocomplete="off"
                        />
                      </div>
                    </nz-collapse-panel>
                    <button *ngIf="!address.value.id" (click)="onAddAddress()">
                      Add Address
                    </button>
                  </ng-container>
                </nz-collapse>
              </div>
              <div class="checkout-title">
                <h4>Terms of Payment</h4>
              </div>
              <nz-radio-group formControlName="selectedCard" class="checkbox">
                <div
                  formArrayName="card"
                  *ngFor="let data of card.controls; index as i"
                >
                  <div [formGroupName]="i">
                    <div class="row">
                      <div class="col-12">
                        <div class="stripe-section">
                          <div class="cards-header">
                            <h5 *ngIf="!data.value.id">Insert a Card</h5>
                            <h5 *ngIf="data.value.id">My card</h5>
                            <div class="radio-option">
                              <label
                                nz-radio
                                [nzValue]="data.value.id"
                              ></label>
                            </div>
                          </div>
                          <div class="content">
                            <table>
                              <tr>
                                <td>owner name</td>
                                <td><input formControlName="owner" /></td>
                              </tr>
                              <tr>
                                <td>cart number</td>
                                <td>
                                  <input
                                    type="tel"
                                    pattern="\d*"
                                    maxlength="19"
                                    formControlName="number"
                                  />
                                </td>
                              </tr>
                              <tr>
                                <td>mm/yy</td>
                                <td>
                                  <nz-input-group nzCompact>
                                    <input
                                      type="text"
                                      nz-input
                                      placeholder="mm/yy"
                                      style="width: 100px; text-align: center"
                                      formControlName="expiry"
                                    />
                                  </nz-input-group>
                                </td>
                              </tr>
                              <tr>
                                <td>cvc</td>
                                <td>
                                  <input
                                    type="tel"
                                    maxlength="3"
                                    formControlName="cvc"
                                  />
                                </td>
                              </tr>
                            </table>
                            <button
                              *ngIf="!data.value.number"
                              (click)="onAddCard()"
                            >
                              Add Card
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </nz-radio-group>
            </div>

            <div class="col-lg-6 col-sm-12 col-xs-12">
              <div class="checkout-details" *ngIf="cart?.length !== 0">
                <div class="order-box">
                  <div class="title-box">
                    <div>Product <span> Total</span></div>
                  </div>
                  <ul class="qty">
                    <li *ngFor="let item of cart">
                      {{ item.variation.name }} × {{ item.quantity }}
                      <span>
                        {{
                          (item.variation.price
                            | discount: item.variation.discount) * item.quantity
                        }}
                        €
                      </span>
                    </li>
                  </ul>
                  <!-- <ul class="sub-total">
                    <li>Subtotal <span class="count">{{total | number : '1.2-2'}} €</span></li>
                  </ul> -->
                  <ul class="total">
                    <li>
                      Total
                      <span class="count">{{ total | number: "1.2-2" }} €</span>
                    </li>
                  </ul>
                </div>
                <div class="payment-box">
                  <div class="upper-box">
                    <!-- <div class="payment-options">
                      <ul>
                        <li>
                          <div class="radio-option">
                            <input
                              type="radio"
                              [value]="'Stripe'"
                              name="payment-group"
                              id="payment-2"
                            />
                            <label for="payment-2"
                              >Stripe
                              <span class="small-text"
                                >Please send a check to Store Name, Store
                                Street, Store Town, Store State / County, Store
                                Postcode.</span
                              ></label
                            >
                          </div>
                        </li>
                        <li>
                          <div class="radio-option paypal">
                            <input
                              type="radio"
                              [value]="'Paypal'"
                              name="payment-group"
                              id="payment-3"
                            />
                            <label for="payment-3"
                              >PayPal<span class="image"
                                ><img
                                  src="assets/images/paypal.png"
                                  alt="" /></span
                            ></label>
                          </div>
                        </li>
                      </ul>
                    </div> -->
                  </div>
                  <div class="text-right">
                    <button
                      type="submit"
                      class="btn-solid btn"
                      (click)="onCheckout()"
                      *ngIf="payment == 'Stripe'"
                    >
                      Place Order
                    </button>
                    <ngx-paypal
                      [config]="payPalConfig"
                      *ngIf="payment == 'Paypal'"
                    ></ngx-paypal>
                  </div>
                </div>
              </div>
              <div class="checkout-details" *ngIf="cart?.length == 0">
                <div class="order-box" *ngIf="cart?.length == 0">
                  <ul class="qty">
                    <li class="empty-checkout">
                      There are no products in cart
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
